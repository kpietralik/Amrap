@page "/WorkoutPlanItem/{WorkoutPlanItemGuid}"

@using Amrap.Core;
@using Amrap.Core.Domain;
@using Amrap.Enum;
@using Amrap.Core.Infrastructure;
@using Bit.BlazorUI

@inject NavigationManager NavigationManager
@inject DatabaseHandler _databaseHandler;

<PageTitle>@title</PageTitle>
<BitLabel>@title</BitLabel>

@if (workoutPlanItem != default)
{
    <BitTextField Label="Title" IsUnderlined="true" @bind-Value="workoutPlanItem.Title" />
    <BitChoiceGroup Label="Day" Items="DayOfWeekList.Items" @bind-Value="workoutPlanItem.Day" />
    
    <p>ToDo: list of planned exercises with links to edit page for each one</p>
    <BitBasicList Items="workoutPlanItem.PlannedExercises"
                  EnableVirtualization="false"
                  Style="border: 1px #a19f9d solid; border-radius: 3px; height: 100%">
        <RowTemplate Context="item">
            <div @key="item.Guid" style="border-bottom: 3px #8a8886 solid; padding: 2px 10px; margin: 5px;">
                <PlannedExercisePreviewComponent WorkoutPlanItem="workoutPlanItem" PlannedExercise="item" />
                @* <BitActionButton IconName="BitIconName.Edit" OnClick="Edit" /> *@
                <p>ToDo: option to remove, edit, add new, set as main, reorder</p>
            </div>
        </RowTemplate>
    </BitBasicList>
    
    <BitNumericTextField Label="Priority" IsUnderlined="true" @bind-Value="workoutPlanItem.Priority" />

    <BitButton Style="margin-top: 20px;" OnClick="Save">Save</BitButton>
}
else
{
    <h3>Loading..</h3>
}

@code {
    [Parameter]
    public string WorkoutPlanItemGuid { get; set; }

    private const string title = "Edit workout plan item";

    private WorkoutPlanItem workoutPlanItem;

    protected override async Task OnInitializedAsync()
    {
        workoutPlanItem = await _databaseHandler.GetWorkoutPlanItem(WorkoutPlanItemGuid);
    }

    private async Task Save()
    {
        await workoutPlanItem.Upsert(_databaseHandler);

        NavigationManager.NavigateTo("/");
    }
}
