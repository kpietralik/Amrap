@page "/"
@using Amrap.Core;
@using Amrap.Core.Domain;
@using Amrap.Core.Infrastructure;
@using Bit.BlazorUI

@inject DatabaseHandler _databaseHandler
@inject WorkoutPlanReader _workoutPlanReader;

<PageTitle>Amrap App</PageTitle>

@if (orderedWorkoutPlanItems == null)
{
    <h1>Loading...</h1>
}
else if (orderedWorkoutPlanItems != null)
{
    <h1>Workout plan (@orderedWorkoutPlanItems.Count())</h1>

    <BitBasicList Items="items"
                  EnableVirtualization="false"
                  Style="border: 1px #a19f9d solid; border-radius: 3px; height: 100%">
        <RowTemplate Context="item">
            <div @key="item.Guid" style="border-bottom: 1px #8a8886 solid; padding: 2px 10px; margin: 5px;">
                <WorkoutPlanItemComponent Item="@item" />
            </div>
        </RowTemplate>
    </BitBasicList>
}

@code {
    private IOrderedEnumerable<WorkoutPlanItem> orderedWorkoutPlanItems;
    private IList<WorkoutPlanItem> items => orderedWorkoutPlanItems?.ToList();

    protected override async Task OnInitializedAsync()
    {
        if (!_databaseHandler.HasInitialized)
        {
            await _databaseHandler.CreateConnectionAndTables();

            await DbSeed.SeedDataIfNeeded(_databaseHandler);
        }

        this.orderedWorkoutPlanItems = await _workoutPlanReader.GetWorkoutPlan();
    }
}