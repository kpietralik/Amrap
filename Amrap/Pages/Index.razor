@page "/"
@using Amrap.Core;
@using Amrap.Core.Domain;
@using Amrap.Core.Infrastructure;
@using Bit.BlazorUI

@inject DatabaseHandler _databaseHandler
@inject WorkoutPlanReader _workoutPlanReader;

<PageTitle>Amrap App</PageTitle>

@if (workoutPlanItems == null)
{
    <h1>Loading...</h1>
}
else if (workoutPlanItems != null)
{
    <h1>Workout plan (@workoutPlanItems.Count())</h1>
    <div class="container mx-auto font-mono flex-auto bg-gray-400">    
        <ul class="flex flex-col w-full">
        @foreach (var item in workoutPlanItems)
        { 
            <li>
            <WorkoutPlanItemComponent Item="@item" />
            </li>
        }
        </ul>
    </div>
}

@code {
    private IOrderedEnumerable<WorkoutPlanItem> workoutPlanItems;

    protected override async Task OnInitializedAsync()
    {
        if (!_databaseHandler.HasInitialized)
        {
            await _databaseHandler.CreateConnectionAndTables();

            await DbSeed.SeedDataIfNeeded(_databaseHandler);
        }

        this.workoutPlanItems = await _workoutPlanReader.GetWorkoutPlan();
    }
}