@page "/newworkoutplanitem"

@using Amrap.Core;
@using Amrap.Core.Domain;
@using Amrap.Enum;
@using Amrap.Core.Infrastructure;
@using Bit.BlazorUI

@inject NavigationManager _navigationManager
@inject DatabaseHandler _databaseHandler;

<PageTitle>@title</PageTitle>
<BitLabel>@title</BitLabel>

<BitChoiceGroup Label="Day" Items="DayOfWeekList.Items" @bind-Value="@dayOfWeek" />
<BitTextField Label="Title" IsUnderlined="true"  @bind-Value="@workOutPlanItemTitle" />
<BitNumericTextField Label="Priority" IsUnderlined="true" @bind-Value="@priority" />

<BitButton Style="margin-top: 20px;" OnClick="Save">Save</BitButton>

@if (saved)
{
    <BitMessageBar MessageBarType="@BitMessageBarType.Success">
        Saved
    </BitMessageBar>
}

@code {
    private const string title = "New workout plan item";

    private string workOutPlanItemTitle { get; set; }
    private float priority { get; set; }
    private DayOfWeek dayOfWeek { get; set; }

    private bool saved { get; set; }

    private const string InvalidInput = "Invalid input";
    private const string Ok = "Ok";

    protected override async Task OnInitializedAsync()
    {}

    private async Task Save()
    {
        if (priority < 0)
        {
            await App.Current.MainPage.DisplayAlert(InvalidInput, "Priority must be a positive number", Ok);
            return;
        }

        var workoutPlanItem = new WorkoutPlanItem(
            Guid.NewGuid().ToString(), dayOfWeek, priority, workOutPlanItemTitle);

        await workoutPlanItem.Add(_databaseHandler);

        saved = true;

        //_navigationManager.NavigateTo($"/newplannedexercise/{ExerciseTypeGuid}/{workoutPlanItem.Guid}");
    }
}
