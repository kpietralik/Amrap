@using Amrap.Core;
@using Amrap.Core.Domain;
@using Amrap.Core.Models;
@using Amrap.Infrastructure.Db;
@using Bit.BlazorUI

@inject DatabaseHandler _databaseHandler;

<div id="component" class="flex flex-row justify-between">
    <div class="flex flex-col basis-3/4">
        <div class="flex-row">
            <div class="divTable" style="border: 4px solid #000;">
                <div class="divTableBody">
                    <div class="divTableRow">
                        <div class="divTableCell">Time</div>
                        <div class="divTableCell">@Item.Time.ToString("r")</div>
                    </div>
                    <div class="divTableRow">
                        <div class="divTableCell">Exercise</div>
                        <div class="divTableCell">@Item.ExerciseType.Name</div>
                    </div>
                    <div class="divTableRow">
                        <div class="divTableCell">Description</div>
                        <div class="divTableCell">@Item.ExerciseType.Description</div>
                    </div>
                    <div class="divTableRow">
                        <div class="divTableCell">Sets</div>
                        <div class="divTableCell">@Item.Sets</div>
                    </div>
                    <div class="divTableRow">
                        <div class="divTableCell">Reps</div>
                        <div class="divTableCell">@Item.Reps</div>
                    </div>
                    <div class="divTableRow">
                        <div class="divTableCell">Weight</div>
                        <div class="divTableCell">@Item.Weight</div>
                    </div>
                    <div class="divTableRow">
                        <div class="divTableCell">Drop set</div>
                        <div class="divTableCell">@(Item.DropSet ? "Yes" : "No")</div>
                    </div>
                    <div class="divTableRow">
                        <div class="divTableCell">To failure</div>
                        <div class="divTableCell">@(Item.ToFailure ? "Yes" : "No")</div>
                    </div>
                </div>
            </div>

            <BitActionButton Style="margin-top: 20px;" IconName="BitIconName.Delete" OnClick="Delete">Delete</BitActionButton>

            @if (deleted)
            {
                <BitMessageBar MessageBarType="@BitMessageBarType.Warning">
                    Deleted
                </BitMessageBar>
            }
        </div>
    </div>
</div>
<br />

@code {
    [Parameter]
    public Amrap.Core.Domain.CompletedExercise Item { get; set; }

    private bool deleted = false;

    protected override async Task OnInitializedAsync()
    {

    }

    public async Task Delete()
    {
        var r = await App.Current.MainPage.DisplayActionSheet(
            $"Delete {Item.ExerciseType.Name}?", "Cancel", "Delete");

        if (r == "Delete")
        {
            Item.Delete(_databaseHandler);
            deleted = true;
        }
    }
}
